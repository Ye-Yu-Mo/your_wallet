# YourWallet 开发流程文档

## 项目概览

YourWallet是一款基于Flutter + Rust技术栈的现代化记账应用。以简洁优雅的界面设计为核心，提供全面的财务管理功能，包括日常收支记录、投资组合管理、以及独特的双人协作记账功能。支持传统资产和加密货币投资追踪。

## 开发环境搭建

### 前端环境（Flutter）

1. **安装Flutter SDK**
   ```bash
   # 下载Flutter SDK
   git clone https://github.com/flutter/flutter.git
   export PATH="$PATH:`pwd`/flutter/bin"
   
   # 验证安装
   flutter doctor
   ```

2. **IDE配置**
   - 推荐使用VS Code + Flutter插件
   - 或Android Studio + Flutter插件

3. **依赖管理**
   ```bash
   cd frontend
   flutter pub get
   ```

### 后端环境（Rust）

1. **安装Rust工具链**
   ```bash
   # 安装rustup
   curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
   
   # 更新工具链
   rustup update
   ```

2. **数据库安装**
   ```bash
   # PostgreSQL
   brew install postgresql
   brew services start postgresql
   
   # Redis
   brew install redis
   brew services start redis
   ```

3. **依赖管理**
   ```bash
   cd backend
   cargo build
   ```

## 开发工作流

### 1. 功能开发流程

```mermaid
graph LR
    A[创建功能分支] --> B[编写代码]
    B --> C[本地测试]
    C --> D[代码审查]
    D --> E[合并主分支]
    E --> F[部署测试]
```

### 2. 分支管理策略

- **main**: 主分支，只包含稳定版本
- **develop**: 开发分支，集成最新功能
- **feature/xxx**: 功能分支，开发具体功能
- **hotfix/xxx**: 紧急修复分支

### 3. 提交规范

使用约定式提交（Conventional Commits）：

```
<类型>(<范围>): <描述>

[可选的正文]

[可选的脚注]
```

**类型说明**：
- `feat`: 新功能
- `fix`: bug修复
- `docs`: 文档更新
- `style`: 代码格式化
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 其他杂项

**示例**：
```bash
git commit -m "feat(auth): add user login functionality"
git commit -m "fix(api): resolve transaction sync issue"
git commit -m "docs: update README with new installation steps"
```

## 开发阶段规划

### Phase 1: MVP基础功能（4-6周）

**第1-2周：项目基础搭建**
- [ ] 初始化Flutter项目结构
- [ ] 搭建Rust后端基础框架
- [ ] 配置数据库连接和基础表结构
- [ ] 实现用户注册登录API

**第3-4周：核心功能开发**
- [ ] 用户认证系统（JWT）
- [ ] 基础交易记录CRUD
- [ ] 简单的数据展示页面
- [ ] 基础的API文档

**第5-6周：双人功能**
- [ ] 用户配对系统设计
- [ ] 共享账本功能
- [ ] 权限管理系统
- [ ] 实时数据同步

### Phase 2: 数据集成（3-4周）

**第7-8周：交易所集成**
- [ ] 币安API集成
- [ ] 欧易API集成
- [ ] 数据同步定时任务
- [ ] 汇率转换服务

**第9-10周：数据处理**
- [ ] 交易数据解析和存储
- [ ] 成本计算算法
- [ ] 盈亏统计功能
- [ ] 数据缓存优化

### Phase 3: 用户体验（3-4周）

**第11-12周：界面优化**
- [ ] 数据可视化图表
- [ ] 响应式设计优化
- [ ] 离线数据支持
- [ ] 用户体验优化

**第13-14周：高级功能**
- [ ] 价格预警系统
- [ ] 数据导出功能
- [ ] 推送通知服务
- [ ] 性能监控

### Phase 4: 测试和发布（2-3周）

**第15-16周：测试完善**
- [ ] 单元测试覆盖
- [ ] 集成测试
- [ ] 安全性测试
- [ ] 性能压测

**第17周：发布准备**
- [ ] 应用商店素材准备
- [ ] 文档完善
- [ ] 版本发布
- [ ] 用户反馈收集

## 代码规范

### Flutter代码规范

1. **目录结构**
   ```
   lib/
   ├── main.dart
   ├── app/                 # 应用配置
   ├── models/             # 数据模型
   ├── services/           # 业务服务
   ├── screens/            # 页面
   ├── widgets/            # 组件
   ├── utils/              # 工具函数
   └── constants/          # 常量
   ```

2. **命名规范**
   - 文件名：使用下划线命名法（snake_case）
   - 类名：使用大驼峰命名法（PascalCase）
   - 变量和函数：使用小驼峰命名法（camelCase）

3. **状态管理**
   - 使用Provider或Riverpod进行状态管理
   - 避免使用全局变量
   - 合理拆分状态管理颗粒度

### Rust代码规范

1. **项目结构**
   ```
   src/
   ├── main.rs
   ├── lib.rs
   ├── api/                # API处理器
   ├── models/             # 数据模型
   ├── services/           # 业务逻辑
   ├── db/                 # 数据库操作
   └── utils/              # 工具函数
   ```

2. **命名规范**
   - 使用snake_case命名函数和变量
   - 使用PascalCase命名结构体和枚举
   - 使用SCREAMING_SNAKE_CASE命名常量

3. **错误处理**
   - 使用Result<T, E>处理可能失败的操作
   - 合理使用?操作符进行错误传播
   - 定义清晰的错误类型

## 测试策略

### 前端测试
- **单元测试**：测试工具函数和业务逻辑
- **组件测试**：测试UI组件的行为
- **集成测试**：测试页面间的交互
- **端到端测试**：测试完整的用户流程

### 后端测试
- **单元测试**：测试函数和模块
- **集成测试**：测试API端点
- **数据库测试**：测试数据操作
- **性能测试**：测试接口响应时间

## 部署流程

### 开发环境
- 本地开发服务器
- 使用Docker Compose启动依赖服务
- 热重载开发模式

### 测试环境
- CI/CD自动部署
- 集成测试自动化
- 性能监控

### 生产环境
- 蓝绿部署策略
- 数据库迁移脚本
- 监控和日志收集

## 常用命令

### Flutter命令
```bash
# 运行应用
flutter run

# 构建APK
flutter build apk

# 运行测试
flutter test

# 生成代码
flutter packages pub run build_runner build
```

### Rust命令
```bash
# 运行开发服务器
cargo run

# 运行测试
cargo test

# 检查代码
cargo clippy

# 格式化代码
cargo fmt

# 构建发布版本
cargo build --release
```

### 数据库命令
```bash
# 运行迁移
sqlx migrate run

# 创建迁移文件
sqlx migrate add <migration_name>

# 重置数据库
sqlx database reset
```

## 问题排查

### 常见问题
1. **Flutter热重载失败**
   - 检查语法错误
   - 重启应用：`r` 或 `R`

2. **Rust编译错误**
   - 检查依赖版本
   - 运行 `cargo clean` 清理缓存

3. **数据库连接失败**
   - 检查数据库服务状态
   - 验证连接配置

### 调试技巧
- 使用适当的日志级别
- 利用IDE的调试功能
- 编写可复现的测试用例

## 团队协作

### 代码审查
- 每个PR至少需要一人审查
- 关注代码质量和规范
- 测试覆盖率要求

### 文档维护
- 及时更新API文档
- 维护变更日志
- 更新用户手册

### 沟通协作
- 使用Issue跟踪问题和需求
- 定期团队会议同步进度
- 知识分享和技术讨论